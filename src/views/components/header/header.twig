<header x-data="headerStore()"
        class="fixed inset-x-0 top-0 z-50"
        :dir="$store.salla.rtl ? 'rtl' : 'ltr'">

  <!-- Backdrop Blur Bar -->
  <div class="bg-background/10 backdrop-blur-[0.5px] border-b border-border/50">
    <div class="mx-auto flex h-16 max-w-7xl items-center justify-between px-6 lg:px-8">

      <!-- Logo -->
      <a href="{{ store.url }}" class="text-2xl font-bold tracking-tight flex items-center gap-1">
        <span class="text-primary">KBI</span>
        <span class="text-foreground">Studios</span>
      </a>

      <!-- Desktop Navigation -->
      <nav class="hidden md:flex items-center gap-8">
        <a href="{{ store.url }}" class="text-sm font-medium text-foreground/80 hover:text-foreground transition">
          {{ t('nav.home') }}
        </a>
        <a href="/services" class="text-sm font-medium text-foreground/80 hover:text-foreground transition">
          {{ t('nav.services') }}
        </a>
        <a href="/gallery" class="text-sm font-medium text-foreground/80 hover:text-foreground transition">
          {{ t('nav.gallery') }}
        </a>
        <a href="/contact" class="text-sm font-medium text-foreground/80 hover:text-foreground transition">
          {{ t('nav.contact') }}
        </a>

        <div class="flex items-center gap-3">

          <!-- Theme Toggle -->
          <button @click="salla.theme.toggle()" 
                  class="p-2 rounded-lg hover:bg-accent/50 transition-all">
            <template x-if="!$store.salla.dark">
              <i class="sicon-moon text-lg"></i>
            </template>
            <template x-if="$store.salla.dark">
              <i class="sicon-sun text-lg text-yellow-400"></i>
            </template>
          </button>

          <!-- Language Dropdown -->
          <div class="relative" x-data="{ langOpen: false }">
            <button @click="langOpen = !langOpen"
                    class="flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium bg-accent/50 hover:bg-accent transition-all">
              <i class="sicon-globe text-sm"></i>
              <span x-text="$store.salla.lang === 'ar' ? 'العربية' : 'English'"></span>
              <i :class="langOpen ? 'rotate-180' : ''" class="sicon-chevron-down text-xs transition-transform"></i>
            </button>

            <div x-show="langOpen" 
                 @click.away="langOpen = false"
                 x-transition
                 class="absolute top-full mt-2 right-0 w-48 bg-card rounded-xl shadow-xl border border-border z-50 overflow-hidden">
              <button @click="salla.lang.change('en'); langOpen = false"
                      class="w-full px-4 py-3 text-sm flex items-center justify-between hover:bg-accent transition"
                      :class="$store.salla.lang === 'en' ? 'bg-accent/50' : ''">
                <span>English</span>
                <i x-show="$store.salla.lang === 'en'" class="sicon-check text-primary"></i>
              </button>
              <button @click="salla.lang.change('ar'); langOpen = false"
                      class="w-full px-4 py-3 text-sm flex items-center justify-between hover:bg-accent transition"
                      :class="$store.salla.lang === 'ar' ? 'bg-accent/50' : ''">
                <span>العربية</span>
                <i x-show="$store.salla.lang === 'ar'" class="sicon-check text-primary"></i>
              </button>
            </div>
          </div>
        </div>
      </nav>

      <!-- Mobile Menu Trigger -->
      <button @click="mobileOpen = true" class="md:hidden p-2">
        <i class="sicon-menu text-2xl"></i>
      </button>
    </div>
  </div>

  <!-- Mobile Sheet Menu (Exact Shadcn/ui Sheet Behavior) -->
  <div x-show="mobileOpen"
       x-transition:enter="transition ease-out duration-300"
       x-transition:enter-start="translate-x-full"
       x-transition:enter-end="translate-x-0"
       x-transition:leave="transition ease-in duration-300"
       x-transition:leave-start="translate-x-0"
       x-transition:leave-end="translate-x-full"
       class="fixed inset-0 z-50 bg-black/50"
       @click="mobileOpen = false">
    
    <div @click.stop 
         :class="$store.salla.rtl ? 'left-0' : 'right-0'"
         class="fixed top-0 bottom-0 w-80 max-w-full bg-background/95 backdrop-blur-xl shadow-2xl">
      
      <div class="flex flex-col h-full p-6">
        <div class="flex items-center justify-between mb-8">
          <a href="{{ store.url }}" class="text-2xl font-bold">
            <span class="text-primary">KBI</span>Studios
          </a>
          <button @click="mobileOpen = false" class="p-2">
            <i class="sicon-close text-2xl"></i>
          </button>
        </div>

        <nav class="flex flex-col gap-6 mb-10">
          <a href="{{ store.url }}" @click="mobileOpen = false" class="text-lg font-medium text-foreground/80 hover:text-foreground">
            {{ t('nav.home') }}
          </a>
          <a href="/services" @click="mobileOpen = false" class="text-lg font-medium text-foreground/80 hover:text-foreground">
            {{ t('nav.services') }}
          </a>
          <a href="/gallery" @click="mobileOpen = false" class="text-lg font-medium text-foreground/80 hover:text-foreground">
            {{ t('nav.gallery') }}
          </a>
          <a href="/contact" @click="mobileOpen = false" class="text-lg font-medium text-foreground/80 hover:text-foreground">
            {{ t('nav.contact') }}
          </a>
        </nav>

        <div class="border-t border-border/50 pt-6 space-y-6">
          <!-- Theme -->
          <div class="flex items-center justify-between">
            <span class="text-sm text-muted-foreground">Theme</span>
            <button @click="salla.theme.toggle()" class="p-2 rounded-lg hover:bg-accent/50">
              <i x-show="!$store.salla.dark" class="sicon-moon"></i>
              <i x-show="$store.salla.dark" class="sicon-sun text-yellow-400"></i>
            </button>
          </div>

          <!-- Language -->
          <div>
            <span class="text-sm text-muted-foreground block mb-3">Language</span>
            <div class="grid grid-cols-2 gap-3">
              <button @click="salla.lang.change('en'); mobileOpen = false"
                      class="px-4 py-3 rounded-lg text-sm font-medium transition-all"
                      :class="$store.salla.lang === 'en' ? 'bg-primary text-white' : 'bg-accent/50 hover:bg-accent'">
                English
              </button>
              <button @click="salla.lang.change('ar'); mobileOpen = false"
                      class="px-4 py-3 rounded-lg text-sm font-medium transition-all"
                      :class="$store.salla.lang === 'ar' ? 'bg-primary text-white' : 'bg-accent/50 hover:bg-accent'">
                العربية
              </button>
            </div>
          </div>

          <!-- Salla User & Cart in Mobile -->
          <div class="flex items-center justify-between pt-6 border-t border-border/30">
            {% if user.type == 'user' %}
              <salla-user-menu avatar-only></salla-user-menu>
            {% else %}
              <button onclick="salla.event.dispatch('login::open')" class="p-3 hover:bg-accent/50 rounded-lg">
                <i class="sicon-user-circle text-xl"></i>
              </button>
            {% endif %}

            <salla-cart-summary class="relative">
              <i slot="icon" class="sicon-shopping-bag text-xl"></i>
              {% if cart.items_count > 0 %}
                <span class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center">
                  {{ cart.items_count }}
                </span>
              {% endif %}
            </salla-cart-summary>
          </div>
        </div>
      </div>
    </div>
  </div>
</header>

<!-- Alpine Store for Clean Code -->
<script>
document.addEventListener('alpine:init', () => {
  Alpine.store('header', {
    mobileOpen: false,
  });

  window.headerStore = () => ({
    mobileOpen: false,
  });
});
</script>